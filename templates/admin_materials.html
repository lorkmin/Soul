{% extends "admin_layout.html" %}
{% block content %}

<h2>Материалы для учеников</h2>

<div class="admin-form">
    <form method="post" action="{{ url_for('admin_materials_add') }}" enctype="multipart/form-data">

        <div class="form-row">
            <div class="form-field">
                <label>Название</label>
                <input name="title" required>
            </div>

            <div class="form-field">
                <label>Тип</label>
                <select name="type">
                    <option value="video">Видео (ссылка)</option>
                    <option value="link">Ссылка</option>
                    <option value="pdf">PDF (файл)</option>
                </select>
            </div>
        </div>

        <div class="form-field">
            <label>Описание</label>
            <textarea name="description" rows="3"></textarea>
        </div>

        <div class="form-field">
            <label>URL (для видео/ссылки)</label>
            <input name="url" placeholder="https://...">
        </div>

        <div class="form-field">
            <label>PDF файл (если тип PDF)</label>
            <input type="file" name="file" accept="application/pdf">
        </div>

        <div class="form-row">
            <div class="form-field">
                <label>Доступ</label>
                <select name="visibility">
                    <option value="all">Всем ученикам</option>
                    <option value="course">Только курсу</option>
                    <option value="student">Конкретному ученику</option>
                </select>
            </div>

            <div class="form-field">
                <label>Курс (если “Только курсу”)</label>
                <input name="course" placeholder="Например: Spark-Boost">
            </div>
        </div>

        <div class="form-field">
            <label>Ученик (если “Конкретному ученику”)</label>
            <select name="student_id">
                <option value="">— не выбран —</option>
                {% for s in students %}
                <option value="{{ s['id'] }}">{{ s['name'] }}{% if s['public_code'] %} ({{ s['public_code'] }}){% endif
                    %}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-row">
            <div class="form-field">
                <label>Порядок</label>
                <input name="sort_order" type="number" value="0">
            </div>

            <div class="form-field">
                <label>Опубликовано</label>
                <select name="is_published">
                    <option value="1" selected>Да</option>
                    <option value="0">Нет (черновик)</option>
                </select>
            </div>
        </div>

        <button class="admin-btn" type="submit">Добавить</button>
    </form>
</div>

<table class="admin-table">
    <thead>
        <tr>
            <th>#</th>
            <th>Название</th>
            <th>Тип</th>
            <th>Доступ</th>
            <th>Опубликовано</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for m in materials %}
        <tr>
            <td>{{ m.id }}</td>
            <td>
                <div><strong>{{ m.title }}</strong></div>
                <div class="admin-meta">{{ m.description or '' }}</div>
            </td>
            <td>{{ m.type }}</td>
            <td>
                {% if m.visibility == 'all' %}всем
                {% elif m.visibility == 'course' %}курс: {{ m.course }}
                {% else %}ученик: {{ m.student_id }}{% endif %}
            </td>
            <td>{{ 'да' if m.is_published else 'нет' }}</td>
            <td style="white-space:nowrap;">
                <form method="post" action="{{ url_for('admin_materials_delete', mid=m.id) }}" class="inline-form"
                    onsubmit="return confirm('Удалить материал?');">
                    <button class="admin-btn admin-btn-danger" type="submit">Удалить</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="6">Пока нет материалов.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}