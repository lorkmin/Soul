{% extends "admin_layout.html" %}
{% block content %}

<div class="teacher-schedule-header">
  <div>
    <h2>Расписание преподавателя</h2>
    <p class="teacher-schedule-subtitle">

      Выберите преподавателя и месяц, чтобы увидеть его занятия в виде календаря.
    </p>
  </div>

  <form method="get" action="{{ url_for('teacher_schedule') }}">
    <label style="font-size:0.8rem;">Преподаватель</label>
    <select name="teacher_id">
      <option value="">— выберите —</option>
      {% for t in teachers %}
      <option value="{{ t.id }}" {% if teacher_id and teacher_id|string==t.id|string %}selected{% endif %}>
        {{ t.name }}
      </option>
      {% endfor %}
    </select>

    <label style="font-size:0.8rem;">Месяц</label>
    <input type="month" name="month" value="{{ month_str }}">

    <button type="submit">Показать</button>
  </form>
</div>

{% if teacher %}
<p class="teacher-schedule-subtitle">

  {{ teacher.name }} — {{ month_name }} {{ year }}
</p>

<div class="teacher-calendar">
  <div class="teacher-calendar-grid">
    <!-- заголовок дней недели -->
    <div class="teacher-cal-head">Пн</div>
    <div class="teacher-cal-head">Вт</div>
    <div class="teacher-cal-head">Ср</div>
    <div class="teacher-cal-head">Чт</div>
    <div class="teacher-cal-head">Пт</div>
    <div class="teacher-cal-head">Сб</div>
    <div class="teacher-cal-head">Вс</div>

    <!-- сами дни -->
    {% for week in weeks %}
    {% for cell in week %}
    <div class="teacher-cal-day {% if not cell.in_month %}other-month{% endif %}">
      <div class="teacher-cal-date">
        {{ cell.date.day }}
      </div>

      {% for l in cell.lessons %}
      <div class="teacher-cal-lesson" title="{{ l.topic or '' }}{% if l.comment %} — {{ l.comment }}{% endif %}">
        <span class="time">
          {{ l.start_at[11:16] }}
        </span>
        {% if l.student_name %}
        <span class="student">{{ l.student_name }}</span>
        {% endif %}
        {% if l.topic %}
        <span class="topic">{{ l.topic }}</span>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% endfor %}
    {% endfor %}
  </div>
</div>
{% elif teacher_id %}
<p class="teacher-schedule-empty">
  Преподаватель не найден или на этот месяц занятий нет.
</p>
{% endif %}

{% endblock %}