{% extends "student_layout.html" %}

{% block title %}
–û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã ‚Äî Soul
{% endblock %}

{% block content %}

<div class="section-title">
    <h3>–û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
    <span>–í–∏–¥–µ–æ, PDF –∏ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</span>
</div>

{% if groups and groups|length > 0 %}

{% for topic, items in groups.items() %}
<div style="margin: 22px 0 10px;">
    <h4 style="margin:0; font-size:18px;">{{ topic }}</h4>
    <div style="height:1px; background:rgba(0,0,0,.06); margin-top:10px;"></div>
</div>

<div class="student-subcards-wrapper">
    {% for m in items %}
    <div class="student-subcard">

        <h4 style="margin-bottom:6px;">{{ m['title'] }}</h4>

        {% if m['description'] %}
        <p style="color:#777; margin-top:0;">{{ m['description'] }}</p>
        {% endif %}

        {# ============ VIDEO ============ #}
        {% if m['type'] == 'video' and m['url'] %}
        {% set u = m['url'] %}

        {# –µ—Å–ª–∏ embed (youtube/vimeo) ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ #}
        {% if 'youtube.com/embed/' in u or 'player.vimeo.com/video/' in u %}
        <div style="aspect-ratio:16/9; border-radius:14px; overflow:hidden; margin-top:10px;">
            <iframe src="{{ u }}" style="width:100%; height:100%; border:0;" allowfullscreen></iframe>
        </div>

        {% else %}
        {# –∏–Ω–∞—á–µ –¥–µ–ª–∞–µ–º –ø—Ä–µ–≤—å—é-–∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è YouTube watch/shorts + –∫–Ω–æ–ø–∫—É #}
        {% set yid = None %}
        {% if 'youtu.be/' in u %}
        {% set yid = u.split('youtu.be/')[-1].split('?')[0].split('/')[0] %}
        {% elif 'youtube.com/watch' in u and 'v=' in u %}
        {% set yid = u.split('v=')[-1].split('&')[0] %}
        {% elif 'youtube.com/shorts/' in u %}
        {% set yid = u.split('youtube.com/shorts/')[-1].split('?')[0].split('/')[0] %}
        {% endif %}

        {% if yid %}
        <a href="{{ u }}" target="_blank" rel="noopener" style="display:block; text-decoration:none; color:inherit;">
            <div style="position:relative; border-radius:14px; overflow:hidden; margin-top:10px;">
                <img src="https://img.youtube.com/vi/{{ yid }}/hqdefault.jpg" alt="preview"
                    style="width:100%; display:block;" />
                <div style="
                      position:absolute; inset:0;
                      display:flex; align-items:center; justify-content:center;
                      background:linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,.05));
                    ">
                    <span style="
                        background: rgba(255,255,255,.92);
                        padding:10px 14px;
                        border-radius: 999px;
                        font-weight:600;
                      ">‚ñ∂ –û—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ</span>
                </div>
            </div>
        </a>
        {% else %}
        <a class="btn-primary" href="{{ u }}" target="_blank" rel="noopener">
            ‚ñ∂ –û—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ
        </a>
        {% endif %}
        {% endif %}

        {# ============ PDF ============ #}
        {% elif m['type'] == 'pdf' and m['file_path'] %}
        {% set pdf_url = url_for('static', filename=m['file_path']) %}

        <div style="position:relative; border-radius:14px; overflow:hidden; margin-top:10px;">
            {# –º–∏–Ω–∏-–ø—Ä–µ–≤—å—é: iframe, –∫–ª–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ–º, —á—Ç–æ–±—ã –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–ª–æ—Å—å –≤–Ω—É—Ç—Ä–∏ #}
            <div style="height:220px; background:#fff;">
                <iframe src="{{ pdf_url }}#page=1&view=FitH"
                    style="width:100%; height:100%; border:0; pointer-events:none;"></iframe>
            </div>

            <div style="
                position:absolute; inset:0;
                display:flex; align-items:flex-end; justify-content:flex-start;
                padding:12px;
                background:linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,0));
              ">
                <a class="btn-primary" href="{{ pdf_url }}" target="_blank" style="text-decoration:none;">
                    üìÑ –û—Ç–∫—Ä—ã—Ç—å PDF
                </a>
            </div>
        </div>

        {# ============ LINK ============ #}
        {% elif m['type'] == 'link' and m['url'] %}
        <a class="btn-primary" href="{{ m['url'] }}" target="_blank" rel="noopener">
            üîó –û—Ç–∫—Ä—ã—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
        </a>
        {% endif %}

    </div>
    {% endfor %}
</div>
{% endfor %}

{% else %}
<p style="color:#777;">–ü–æ–∫–∞ –Ω–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.</p>
{% endif %}

{% endblock %}