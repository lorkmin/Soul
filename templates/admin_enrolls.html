{% extends "admin_layout.html" %} {% block content %}
<div class="top-actions" style="
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
  ">
  <div>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫: {{ enrolls|length }}</div>
  <div>
    <a class="btn-link" href="{{ url_for('admin_enrolls_export') }}">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</a>
  </div>
</div>

<style>
  /* ===== Enrolls: bot + notes (clean UI) ===== */

  .admin-note-box {
    display: grid;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.08);
  }

  /* Top row: switch + status badge */
  .bot-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
  }

  /* BOT badge (in bot column) */
  .bot-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 0.82rem;
    font-weight: 800;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.06);
    color: rgba(255, 255, 255, 0.85);
  }

  .bot-badge .dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.35);
  }

  .bot-badge.is-bot {
    background: rgba(255, 70, 70, 0.16);
    border-color: rgba(255, 70, 70, 0.35);
    color: rgba(255, 255, 255, 0.92);
  }

  .bot-badge.is-bot .dot {
    background: rgba(255, 70, 70, 0.95);
    box-shadow: 0 0 0 3px rgba(255, 70, 70, 0.18);
  }

  /* Switch */
  .bot-switch {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    user-select: none;
  }

  .bot-switch input {
    display: none;
  }

  .bot-switch .track {
    width: 46px;
    height: 26px;
    border-radius: 999px;
    position: relative;
    border: 1px solid rgba(255, 255, 255, 0.14);
    background: rgba(255, 255, 255, 0.08);
    transition: background 0.2s ease, border-color 0.2s ease;
    box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.12);
  }

  .bot-switch .thumb {
    position: absolute;
    top: 3px;
    left: 3px;
    width: 20px;
    height: 20px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.92);
    transition: transform 0.2s ease;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
  }

  .bot-switch .label {
    font-size: 0.9rem;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.88);
  }

  .bot-switch input:checked+.track {
    background: rgba(255, 70, 70, 0.26);
    border-color: rgba(255, 70, 70, 0.45);
  }

  .bot-switch input:checked+.track .thumb {
    transform: translateX(20px);
  }

  /* Notes textarea */
  .admin-note-input {
    width: 100%;
    min-height: 62px;
    resize: vertical;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(0, 0, 0, 0.2);
    color: rgba(255, 255, 255, 0.92);
    outline: none;
  }

  .admin-note-input::placeholder {
    color: rgba(255, 255, 255, 0.45);
  }

  .admin-note-input:focus {
    border-color: rgba(255, 205, 90, 0.55);
    box-shadow: 0 0 0 3px rgba(255, 205, 90, 0.12);
  }

  /* Saved note preview (compact, not duplicate-y) */
  .admin-note-preview {
    display: flex;
    gap: 8px;
    align-items: flex-start;
    padding: 10px 12px;
    border-radius: 12px;
    background: rgba(255, 205, 90, 0.1);
    border: 1px solid rgba(255, 205, 90, 0.22);
    color: rgba(255, 255, 255, 0.88);
    font-size: 0.9rem;
  }

  .admin-note-preview .icon {
    line-height: 1;
    margin-top: 2px;
  }

  /* Save button row */
  .note-actions-row {
    display: flex;
    justify-content: flex-end;
  }

  /* small helper text */
  .note-hint {
    font-size: 0.82rem;
    color: rgba(255, 255, 255, 0.55);
    margin-top: -4px;
  }
</style>

<table class="admin-table">
  <thead>
    <tr>
      <th>#</th>
      <th>–î–∞—Ç–∞ / IP</th>
      <th>–ò–º—è / –ö–æ–Ω—Ç–∞–∫—Ç</th>
      <th>–ü–∞–∫–µ—Ç / –£—Ä–æ–≤–µ–Ω—å</th>
      <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
      <th>–ë–æ—Ç</th>
      <th style="min-width: 340px">–ó–∞–º–µ—Ç–∫–∞ –∞–¥–º–∏–Ω–∞</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    {% for e in enrolls %}
    <tr>
      <td>{{ e.id }}</td>

      <td>
        <div>{{ e.created_at }}</div>
        <div class="admin-meta">{{ e.ip }}</div>
      </td>

      <td>
        <div>{{ e.name }}</div>
        <div class="admin-meta">{{ e.contact }}</div>
      </td>

      <td>
        <div>{{ e.tariff or "‚Äî" }}</div>
        <div class="admin-meta">{{ e.level or "‚Äî" }}</div>
      </td>

      <td>{{ e.comment or "" }}</td>

      <td style="white-space: nowrap">
        {% if e.is_bot %}
        <span class="bot-badge is-bot"><span class="dot"></span> BOT</span>
        {% else %}
        <span class="bot-badge"><span class="dot"></span> ‚Äî</span>
        {% endif %}
      </td>

      <td>
        {# –í–ê–ñ–ù–û: —á–µ–∫–±–æ–∫—Å –∏ textarea –≤–Ω—É—Ç—Ä–∏ –≠–¢–û–ì–û –ñ–ï form, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ submit
        #}
        <form method="post" action="{{ url_for('admin_enroll_note', enroll_id=e.id) }}" class="admin-note-box">
          <div class="bot-actions">
            <!-- hidden –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç 0 –µ—Å–ª–∏ —á–µ–∫–±–æ–∫—Å —Å–Ω—è—Ç -->
            <input type="hidden" name="is_bot" value="0" />

            <label class="bot-switch">
              <input type="checkbox" name="is_bot" value="1" {% if e.is_bot %}checked{% endif %} />
              <span class="track"><span class="thumb"></span></span>
              <span class="label">–ë–æ—Ç</span>
            </label>

            <div class="note-hint">–≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É</div>
          </div>

          <textarea class="admin-note-input" name="admin_note"
            placeholder="–ó–∞–º–µ—Ç–∫–∞ –∞–¥–º–∏–Ω–∞: —Å–ø–∞–º / –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å / –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏‚Ä¶">
{{ e.admin_note or "" }}</textarea>

          {% if e.admin_note %}
          <div class="admin-note-preview">
            <span class="icon">üí¨</span>
            <div>{{ e.admin_note }}</div>
          </div>
          {% endif %}

          <div class="note-actions-row">
            <button type="submit" class="admin-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </form>
      </td>

      <td></td>
    </tr>
    {% else %}
    <tr>
      <td colspan="8">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}