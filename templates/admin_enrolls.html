{% extends "admin_layout.html" %} {% block content %}
<div class="top-actions enrolls-top-actions">

  <div>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫: {{ enrolls|length }}</div>
  <div>
    <a class="btn-link" href="{{ url_for('admin_enrolls_export') }}">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</a>
  </div>
</div>
<div class="table-scroll">
  <table class="admin-table enrolls-table">
    <thead>
      <tr>
        <th>#</th>
        <th>–î–∞—Ç–∞ / IP</th>
        <th>–ò–º—è / –ö–æ–Ω—Ç–∞–∫—Ç</th>
        <th>–ü–∞–∫–µ—Ç / –£—Ä–æ–≤–µ–Ω—å</th>
        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
        <th>–ë–æ—Ç</th>
        <th style="min-width: 340px">–ó–∞–º–µ—Ç–∫–∞ –∞–¥–º–∏–Ω–∞</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      {% for e in enrolls %}
      <tr>
        <td>{{ e.id }}</td>

        <td>
          <div>{{ e.created_at }}</div>
          <div class="admin-meta">{{ e.ip }}</div>
        </td>

        <td>
          <div>{{ e.name }}</div>
          <div class="admin-meta">{{ e.contact }}</div>
        </td>

        <td>
          <div>{{ e.tariff or "‚Äî" }}</div>
          <div class="admin-meta">{{ e.level or "‚Äî" }}</div>
        </td>

        <td class="enroll-comment-cell">
          {% if e.comment %}
            {% set is_long = e.comment|length > 50 %}
            {% if is_long %}
              <details class="enroll-comment">
                <summary>{{ e.comment[:50] }}&hellip;</summary>
                <div class="enroll-comment__full">{{ e.comment }}</div>
              </details>
            {% else %}
              <span class="enroll-comment__text">{{ e.comment }}</span>
            {% endif %}
          {% endif %}
        </td>

        <td style="white-space: nowrap">
          {% if e.is_bot %}
          <span class="bot-badge is-bot"><span class="dot"></span> BOT</span>
          {% else %}
          <span class="bot-badge"><span class="dot"></span> ‚Äî</span>
          {% endif %}
        </td>

        <td>
          {# –í–ê–ñ–ù–û: —á–µ–∫–±–æ–∫—Å –∏ textarea –≤–Ω—É—Ç—Ä–∏ –≠–¢–û–ì–û –ñ–ï form, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∞ submit
          #}
          <form method="post" action="{{ url_for('admin_enroll_note', enroll_id=e.id) }}" class="admin-note-box">
            <div class="bot-actions">
              <!-- hidden –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç 0 –µ—Å–ª–∏ —á–µ–∫–±–æ–∫—Å —Å–Ω—è—Ç -->
              <input type="hidden" name="is_bot" value="0" />

              <label class="bot-switch">
                <input type="checkbox" name="is_bot" value="1" {% if e.is_bot %}checked{% endif %} />
                <span class="track"><span class="thumb"></span></span>
                <span class="label">–ë–æ—Ç</span>
              </label>

              <div class="note-hint">–≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É</div>
            </div>

            <textarea class="admin-note-input" name="admin_note"
              placeholder="–ó–∞–º–µ—Ç–∫–∞ –∞–¥–º–∏–Ω–∞: —Å–ø–∞–º / –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å / –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏‚Ä¶">{{- e.admin_note or "" -}}</textarea>


            {% if e.admin_note %}
            <div class="admin-note-preview">
              <span class="icon">üí¨</span>
              <div>{{ e.admin_note }}</div>
            </div>
            {% endif %}

            <div class="note-actions-row">
              <button type="submit" class="admin-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
          </form>
        </td>

        <td></td>
      </tr>
      {% else %}
      <tr>
        <td colspan="8">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
