<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–õ–∏—á–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —É—á–µ–Ω–∏–∫–∞ ‚Äî Soul</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style_light.css') }}"
    />
  </head>
  <body class="student-dashboard">
    <div class="wrapper">
      <section>
        <div class="section-inner">
          <div class="section-title">
            <h3>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —É—á–µ–Ω–∏–∫–∞</h3>
            <span>–ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∞—à–∏ –æ–ø–ª–∞—Ç—ã –∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–Ω—è—Ç–∏—è</span>
          </div>

          <div class="enroll-box student-dashboard-card">
            <form method="post">
              <div class="form-field">
                <label for="code">–í–∞—à 6-–∑–Ω–∞—á–Ω—ã–π ID</label>
                <input
                  id="code"
                  name="code"
                  type="text"
                  maxlength="6"
                  placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 038421"
                  value="{{ code or '' }}"
                  required
                />
              </div>
              <button class="btn-primary form-submit" type="submit">
                –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
              </button>
            </form>
{% if total > 0 and left <= 0 %}
<div class="student-alert-wrapper">
  <div class="student-alert student-alert-warning">
    <div class="student-alert-icon">‚ö†Ô∏è</div>

    <div class="student-alert-content">
      <div class="student-alert-title">
        –ü–∞–∫–µ—Ç –∑–∞–Ω—è—Ç–∏–π –∑–∞–∫–æ–Ω—á–∏–ª—Å—è
      </div>

      <div class="student-alert-text">
        –ù–æ–≤—ã–µ —É—Ä–æ–∫–∏ –Ω–µ –±—É–¥—É—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å—Å—è, –ø–æ–∫–∞ –≤—ã –Ω–µ –ø—Ä–æ–¥–ª–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ üíõ  
        –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ø–∞–∫–µ—Ç.
      </div>

      <a href="#enroll" class="student-alert-button">–ü—Ä–æ–¥–ª–∏—Ç—å –∑–∞–Ω—è—Ç–∏—è</a>
    </div>
  </div>
</div>
{% endif %}

            {% if not_found %}
            <p style="color: #c00; margin-top: 10px">
              –ó–∞–ø–∏—Å—å —Å —Ç–∞–∫–∏–º ID –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –∏–ª–∏ —Å–ø—Ä–æ—Å–∏—Ç–µ —É
              –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è.
            </p>
            {% endif %} {% if student %}

            <hr
              style="
                margin: 20px 0;
                border: none;
                border-top: 1px solid rgba(0, 0, 0, 0.06);
              "
            />

            {# –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —á–∏—Å–µ–ª –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ #} {% set total =
            (student['lessons_total'] or 0)|int %} {% set left =
            (student['lessons_left'] or 0)|int %} {% if total > 0 %} {% set done
            = total - left %} {% if done < 0 %}{% set done = 0 %}{% endif %} {%
            if done > total %}{% set done = total %}{% endif %} {% set percent =
            (done * 100 / total)|round(0)|int %} {% else %} {% set done = 0 %}
            {% set percent = 0 %} {% endif %} {% set done_count =
            lessons_done|length %}

            <!-- –í–ï–†–•–ù–Ø–Ø –ö–ê–†–¢–û–ß–ö–ê –° –£–ß–ï–ù–ò–ö–û–ú -->
            <div class="student-hero-card">
              <div class="student-hero-main">
                <div class="student-hero-avatar">
                  <span class="student-hero-avatar-char">
                    {{ (student['name'] or 'U')[:1] }}
                  </span>
                  <span class="student-hero-avatar-sparkle">‚ú®</span>
                </div>

                <div class="student-hero-info">
                  <div class="student-hero-title-row">
                    <h4 class="student-hero-name">
                      {{ student['name'] or '–£—á–µ–Ω–∏–∫' }}
                    </h4>
                    {% if student['public_code'] %}
                    <span class="student-hero-id-badge">
                      ID: {{ student['public_code'] }}
                    </span>
                    {% endif %}
                  </div>

                  {% if student['course'] %}
                  <p class="student-hero-course">
                    üå∏ –ö—É—Ä—Å: <span>{{ student['course'] }}</span>
                  </p>
                  {% endif %}

                  <p class="student-hero-sub">
                    –í–∞—à —É—é—Ç–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –∫–æ—Ä–µ–π—Å–∫–æ–º üíï
                  </p>

                  <div class="student-hero-numbers">
                    <div class="student-hero-number">
                      <span class="label">–í—Å–µ–≥–æ –∑–∞–Ω—è—Ç–∏–π</span>
                      <span class="value">
                        {{ total if total > 0 else '‚Äî' }}
                      </span>
                    </div>
                    <div class="student-hero-number">
                      <span class="label">–û—Å—Ç–∞–ª–æ—Å—å</span>
                      <span class="value">
                        {{ left if total > 0 else '‚Äî' }}
                      </span>
                    </div>
                    <div class="student-hero-number">
                      <span class="label">–ü—Ä–æ–π–¥–µ–Ω–æ</span>
                      <span class="value">
                        {% if total > 0 %}{{ done }} ({{ percent }}%){% else
                        %}‚Äî{% endif %}
                      </span>
                    </div>
                  </div>

                  <div class="student-hero-payment">
                    <span class="student-hero-payment-label"
                      >–ü–æ—Å–ª–µ–¥–Ω—è—è –æ–ø–ª–∞—Ç–∞:</span
                    >
                    <span class="student-hero-payment-value">
                      {{ student['last_payment_date'] or '‚Äî' }} {% if
                      student['last_payment_amount'] %} ¬∑ {{
                      student['last_payment_amount'] }} ‚ÇΩ {% endif %}
                    </span>
                  </div>

                  {% if student['comment'] %}
                  <p class="student-hero-comment">
                    <span class="comment-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç —à–∫–æ–ª—ã:</span>
                    <span class="comment-text">{{ student['comment'] }}</span>
                  </p>
                  {% endif %}
                </div>
              </div>

              <div class="student-hero-side">
                {% if total > 0 %}
                <div class="student-progress-card">
                  <div class="student-progress-header">
                    <span class="chip chip-soft">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –ø–∞–∫–µ—Ç—É</span>
                    <span class="percent">{{ percent }}%</span>
                  </div>
                  <div class="student-progress-bar">
                    <div
                      class="student-progress-fill"
                      style="width: {{ percent }}%;"
                    ></div>
                  </div>
                  <div class="student-progress-meta">
                    –ü—Ä–æ–π–¥–µ–Ω–æ {{ done }} –∏–∑ {{ total }} —É—Ä–æ–∫–æ–≤
                  </div>
                </div>
                {% endif %} {% if done_count > 0 or total > 0 %}
                <div class="student-achievements-card">
                  <div class="student-achievements-header">
                    <span class="title">–í–∞—à–∏ –º–∞–ª–µ–Ω—å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
                    <span class="sparkle">‚ú®</span>
                  </div>
                  <ul class="student-achievements-list">
                    {% if done_count >= 1 %}
                    <li>
                      <span class="badge-icon">üå±</span>
                      <span class="badge-text">
                        –ü–µ—Ä–≤—ã–π —à–∞–≥ ‚Äî –≤—ã —É–∂–µ –Ω–∞—á–∞–ª–∏ –ø—É—Ç—å!
                      </span>
                    </li>
                    {% endif %} {% if done_count >= 3 %}
                    <li>
                      <span class="badge-icon">üî•</span>
                      <span class="badge-text">
                        –¢—Ä–∏ –∑–∞–Ω—è—Ç–∏—è –ø–æ–∑–∞–¥–∏ ‚Äî –¥–µ—Ä–∂–∏—Ç–µ —Ä–∏—Ç–º üí™
                      </span>
                    </li>
                    {% endif %} {% if percent >= 50 and percent < 100 %}
                    <li>
                      <span class="badge-icon">üåà</span>
                      <span class="badge-text">
                        –ü–æ–ª–æ–≤–∏–Ω–∞ –∫—É—Ä—Å–∞ –ø—Ä–æ–π–¥–µ–Ω–∞ ‚Äî –≤—ã —É–∂–µ –¥–∞–ª–µ–∫–æ –ø—Ä–æ–¥–≤–∏–Ω—É–ª–∏—Å—å!
                      </span>
                    </li>
                    {% endif %} {% if percent >= 90 and left > 0 %}
                    <li>
                      <span class="badge-icon">üöÄ</span>
                      <span class="badge-text">
                        –§–∏–Ω–∏—à –±–ª–∏–∑–∫–æ ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–∫–æ–≤.
                      </span>
                    </li>
                    {% endif %} {% if total > 0 and left == 0 and done > 0 %}
                    <li>
                      <span class="badge-icon">üèÖ</span>
                      <span class="badge-text">
                        –ü–∞–∫–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî –≤—ã –±–æ–ª—å—à–æ–µ —É–º–Ω–∏—á–∫–∞!
                      </span>
                    </li>
                    {% endif %}
                  </ul>
                </div>
                {% endif %}
              </div>
            </div>

            <!-- –ù–ò–ñ–ù–ò–ï –ö–ê–†–¢–û–ß–ö–ò: –†–ê–°–ü–ò–°–ê–ù–ò–ï + –î–ó -->
            <div class="student-subcards-wrapper">
              <!-- –í–ê–®–ò –ó–ê–ù–Ø–¢–ò–Ø -->
              <div class="student-subcard">
                <h4 style="margin-bottom: 8px">–í–∞—à–∏ –∑–∞–Ω—è—Ç–∏—è</h4>

                {% if lessons_planned or lessons_rescheduled or lessons_done or
                lessons_canceled %}
                <div class="student-lessons-sections">
                  {% if lessons_planned %}
                  <div class="student-lessons-section">
                    <p class="student-lessons-label">–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–Ω—è—Ç–∏—è</p>
                    <ul class="student-lessons-list">
                      {% for l in lessons_planned %}
                      <li
                        class="lesson-row {% if loop.first %}lesson-next{% endif %}"
                      >
                        <div class="lesson-main">
                          <div>
                            {% if loop.first %}
                            <span class="lesson-next-badge">–°–∫–æ—Ä–æ</span>
                            {% endif %}
                            <span class="lesson-date">{{ l['start_at'] }}</span>
                            {% if l['topic'] %}
                            <span class="lesson-dot">‚Ä¢</span>
                            <span class="lesson-topic">{{ l['topic'] }}</span>
                            {% endif %}
                          </div>

                          {% if l['comment'] %}
                          <div class="lesson-comment">{{ l['comment'] }}</div>
                          {% endif %}
                        </div>

                        <span class="lesson-status-badge lesson-status-planned">
                          –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
                        </span>
                      </li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %} {% if lessons_rescheduled %}
                  <div class="student-lessons-section">
                    <p class="student-lessons-label">–ü–µ—Ä–µ–Ω–µ—Å—ë–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è</p>
                    <ul class="student-lessons-list">
                      {% for l in lessons_rescheduled %}
                      <li class="lesson-row">
                        <div class="lesson-main">
                          <span class="lesson-date">{{ l['start_at'] }}</span>
                          {% if l['rescheduled_to'] %}
                          <span class="lesson-arrow">‚Üí</span>
                          <span class="lesson-date"
                            >{{ l['rescheduled_to'] }}</span
                          >
                          {% endif %} {% if l['topic'] %}
                          <span class="lesson-dot">‚Ä¢</span>
                          <span class="lesson-topic">{{ l['topic'] }}</span>
                          {% endif %} {% if l['comment'] %}
                          <div class="lesson-comment">{{ l['comment'] }}</div>
                          {% endif %}
                        </div>
                        <span
                          class="lesson-status-badge lesson-status-rescheduled"
                        >
                          –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ
                        </span>
                      </li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %} {% if lessons_done %}
                  <div class="student-lessons-section">
                    <p class="student-lessons-label">–ü—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è</p>
                    <ul class="student-lessons-list">
                      {% for l in lessons_done %}
                      <li class="lesson-row">
                        <div class="lesson-main">
                          <span class="lesson-date">{{ l['start_at'] }}</span>
                          {% if l['topic'] %}
                          <span class="lesson-dot">‚Ä¢</span>
                          <span class="lesson-topic">{{ l['topic'] }}</span>
                          {% endif %} {% if l['comment'] %}
                          <div class="lesson-comment">{{ l['comment'] }}</div>
                          {% endif %}
                        </div>
                        <span class="lesson-status-badge lesson-status-done">
                          –ü—Ä–æ–≤–µ–¥–µ–Ω–æ
                        </span>
                      </li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %} {% if lessons_canceled %}
                  <div class="student-lessons-section">
                    <p class="student-lessons-label">–û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è</p>
                    <ul class="student-lessons-list">
                      {% for l in lessons_canceled %}
                      <li class="lesson-row">
                        <div class="lesson-main">
                          <span class="lesson-date">{{ l['start_at'] }}</span>
                          {% if l['topic'] %}
                          <span class="lesson-dot">‚Ä¢</span>
                          <span class="lesson-topic">{{ l['topic'] }}</span>
                          {% endif %} {% if l['comment'] %}
                          <div class="lesson-comment">{{ l['comment'] }}</div>
                          {% endif %}
                        </div>
                        <span
                          class="lesson-status-badge lesson-status-canceled"
                        >
                          –û—Ç–º–µ–Ω–µ–Ω–æ
                        </span>
                      </li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %}
                </div>
                {% else %}
                <p style="font-size: 0.9rem; color: #777; margin-top: 6px">
                  –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ. –°–ø—Ä–æ—Å–∏—Ç–µ —É –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è, –∫–æ–≥–¥–∞
                  –±—É–¥–µ—Ç –±–ª–∏–∂–∞–π—à–µ–µ –∑–∞–Ω—è—Ç–∏–µ üôÇ
                </p>
                {% endif %}
              </div>

              <!-- –î–û–ú–ê–®–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø -->
              <div class="student-subcard">
                <h4 style="margin-bottom: 8px">–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h4>

                <form
                  method="post"
                  enctype="multipart/form-data"
                  class="enroll-box"
                  style="
                    max-width: 520px;
                    padding: 14px 16px;
                    margin-bottom: 14px;
                  "
                >
                  <input type="hidden" name="action" value="upload_homework" />
                  <input type="hidden" name="code" value="{{ code }}" />

                  <div class="form-field">
                    <label for="hw-title">–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</label>
                    <input
                      id="hw-title"
                      type="text"
                      name="hw_title"
                      placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–ó –ø–æ —Ç–µ–º–µ ¬´–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è¬ª"
                    />
                  </div>

                  <div class="form-field">
                    <label for="hw-comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea
                      id="hw-comment"
                      name="hw_comment"
                      rows="2"
                      placeholder="–ß—Ç–æ –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ, –≤–æ–ø—Ä–æ—Å—ã –∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é‚Ä¶"
                    ></textarea>
                  </div>

                  <div class="form-field">
                    <label for="hw-file">–§–∞–π–ª –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è</label>
                    <input id="hw-file" type="file" name="hw_file" required />
                    <p class="form-note" style="margin-top: 4px">
                      –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ —Ç–µ—Ç—Ä–∞–¥–∏, PDF –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç.
                    </p>
                  </div>

                  <button class="btn-primary form-submit" type="submit">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
                  </button>
                </form>

                {% if homework_list %}
                <ul class="student-homework-list">
                  {% for hw in homework_list %}
                  <li class="student-homework-item">
                    <div class="student-homework-header">
                      <div>
                        <span class="lesson-date">
                          {{ hw['created_at'] or '' }}
                        </span>
                        ¬∑
                        <strong>{{ hw['title'] or '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}</strong>
                      </div>
 <div class="student-homework-status">
  {% if hw['status'] == 'checked' %}
    <span class="lesson-status-badge lesson-status-done">
      –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ
    </span>
  {% elif hw['status'] == 'assigned' and not hw['file_path'] %}
    <span class="lesson-status-badge lesson-status-planned">
      –ó–∞–¥–∞–Ω–∏–µ –æ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
    </span>
  {% elif hw['status'] == 'new' %}
    <span class="lesson-status-badge lesson-status-planned">
      –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –∂–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
    </span>
  {% else %}
    <span class="lesson-status-badge lesson-status-planned">
      –í —Ä–∞–±–æ—Ç–µ
    </span>
  {% endif %}
</div>


                    {% if hw['comment'] %}
                    <div class="lesson-comment" style="margin-top: 4px">
                      –í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: {{ hw['comment'] }}
                    </div>
                    {% endif %}

<div class="student-homework-files">
  {% if hw['file_path'] %}
  <div>
    <span class="lesson-topic">–í–∞—à —Ñ–∞–π–ª: </span>
    <a href="{{ url_for('static', filename=hw['file_path']) }}" target="_blank">
      –æ—Ç–∫—Ä—ã—Ç—å
    </a>
  </div>
  {% endif %}
  {% if hw['teacher_file_path'] %}
  <div style="margin-top: 2px">
    <span class="lesson-topic">–§–∞–π–ª –æ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è: </span>
    <a
      href="{{ url_for('static', filename=hw['teacher_file_path']) }}"
      target="_blank"
    >
      —Å–∫–∞—á–∞—Ç—å
    </a>
  </div>
  {% endif %}
</div>


                    {% if hw['teacher_comment'] %}
                    <div class="lesson-comment" style="margin-top: 6px">
                      –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è: {{ hw['teacher_comment'] }}
                    </div>
                    {% endif %} {% if hw['checked_at'] %}
                    <div class="student-homework-meta">
                      –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: {{ hw['checked_at'] }}
                    </div>
                    {% endif %}
                  </li>
                  {% endfor %}
                </ul>
                {% else %}
                <p style="font-size: 0.9rem; color: #777; margin-top: 6px">
                  –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π.
                </p>
                {% endif %}
              </div>
            </div>
            <!-- /student-subcards-wrapper -->

            {% else %}
            <p style="font-size: 0.9rem; color: #777; margin-top: 12px">
              –í–≤–µ–¥–∏—Ç–µ ID —É—á–µ–Ω–∏–∫–∞, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–º–∞—à–Ω–µ–µ
              –∑–∞–¥–∞–Ω–∏–µ.
            </p>
            {% endif %}
          </div>
        </div>
      </section>
    </div>
  </body>
</html>
