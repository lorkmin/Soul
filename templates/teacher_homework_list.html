{% extends "admin_layout.html" %}
{% block content %}

<div class="hw-header">
  <h2>Домашние задания</h2>
  <a href="{{ url_for('teacher_homework_add') }}" class="admin-btn hw-add-btn">
    + Выдать новое задание
  </a>
</div>

{# ===== ФИЛЬТРЫ ===== #}
<form method="get" class="admin-form hw-filters" style="margin: 14px 0 18px;">
  <div class="form-row" style="align-items:flex-end; gap:12px; flex-wrap:wrap;">

    <div class="form-field" style="min-width:240px;">
      <label>Преподаватель (чьи ученики)</label>
      <select name="teacher_id">
        <option value="">— все —</option>
        {% for t in teachers %}
        <option value="{{ t['id'] }}" {% if f_teacher_id and f_teacher_id|int==t['id'] %}selected{% endif %}>
          {{ t['name'] }}
        </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-field" style="min-width:240px;">
      <label>Ученик</label>
      <select name="student_id">
        <option value="">— все —</option>
        {% for s in students %}
        <option value="{{ s['id'] }}" {% if f_student_id and f_student_id|int==s['id'] %}selected{% endif %}>
          {{ s['name'] or ('#' ~ s['id']) }}
        </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-field" style="min-width:200px;">
      <label>Статус</label>
      <select name="status">
        <option value="" {% if not f_status %}selected{% endif %}>— любой —</option>
        <option value="new" {% if f_status=='new' %}selected{% endif %}>Новое</option>
        <option value="checked" {% if f_status=='checked' %}selected{% endif %}>Проверено</option>
      </select>
    </div>

    <div class="form-field" style="display:flex; gap:10px;">
      <button class="admin-btn" type="submit">Применить</button>
      <a class="admin-btn admin-btn-secondary" href="{{ url_for('teacher_homework_list') }}">Сброс</a>
    </div>

  </div>
</form>

<table class="admin-table hw-table">
  <thead>
    <tr>
      <th>Дата</th>
      <th>Ученик</th>
      <th>Курс</th>
      <th>ДЗ</th>
      <th>Статус</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    {% for hw in homework %}
    <tr>
      <td class="hw-date">{{ hw['created_at'] or '' }}</td>

      <td>
        <div><strong>{{ hw['student_name'] or 'Без имени' }}</strong></div>

        {% if hw['student_code'] %}
        <div class="student-code">ID: {{ hw['student_code'] }}</div>
        {% endif %}

        {# Если из SQL добавишь teacher_name — будет красиво показывать #}
        {% if hw['teacher_name'] %}
        <div class="admin-note">Преподаватель: {{ hw['teacher_name'] }}</div>
        {% endif %}
      </td>

      <td>{{ hw['student_course'] or 'Не указан' }}</td>

      <td class="hw-task">
        <div>{{ hw['title'] or 'Без названия' }}</div>

        {% if hw['comment'] %}
        <div class="admin-note">{{ hw['comment'] }}</div>
        {% endif %}

        {% if hw['file_path'] %}
        <div class="hw-link-row">
          <a href="{{ url_for('static', filename=hw['file_path']) }}" target="_blank">
            Открыть файл ученика
          </a>
        </div>
        {% endif %}

        {% if hw['teacher_file_path'] %}
        <div class="hw-link-row hw-teacher-reply">
          Ответ:
          <a href="{{ url_for('static', filename=hw['teacher_file_path']) }}" target="_blank">
            файл преподавателя
          </a>
        </div>
        {% endif %}
      </td>

      <td>
        {% if hw['status'] == 'new' %}
        <span class="badge-status badge-status-new">Новое</span>
        {% elif hw['status'] == 'checked' %}
        <span class="badge-status badge-status-checked">Проверено</span>
        {% else %}
        <span class="badge-status">{{ hw['status'] }}</span>
        {% endif %}
      </td>

      <td class="hw-actions">
        <a href="{{ url_for('teacher_homework_review', hw_id=hw['id']) }}" class="admin-btn">
          Проверить
        </a>

        <form method="post" action="{{ url_for('teacher_homework_delete', hw_id=hw['id']) }}" class="inline-form"
          onsubmit="return confirm('Удалить это ДЗ? Запись и файлы будут удалены.');">
          <button type="submit" class="admin-btn admin-btn-danger">
            Удалить
          </button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="6">Домашних заданий пока нет.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}